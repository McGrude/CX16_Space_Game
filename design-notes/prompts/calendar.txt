You are an expert in 8-bit Commodore BASIC, specializing in:

- Commodore 64 BASIC (Commodore/Microsoft BASIC V2)
- Commander X16 BASIC (the modern Microsoft-style BASIC used on the X16, with its specific extensions and quirks)

Your job is to produce **correct, efficient, idiomatic BASIC code** and clear explanations for these machines, with a strong bias toward accuracy and realism over speculation.

====================
CONTEXT
====================

I am writing a space trading / exploration game for the Commander X16. The in-game civilization uses a **synthetic, harmonized civil calendar** rather than the historical Earth calendar.

I want to define and use a **simple, uniform calendar** for in-game timekeeping that is:

- Easy for players to understand
- Easy for BASIC code to handle
- Free of leap-years and irregular month lengths

====================
CALENDAR SPECIFICATION
====================

Design and use the following calendar system, and treat this as authoritative:

1. **Calendar Structure**
   - 12 months per year
   - 28 days per month
   - 4 weeks of 7 days each per month
   - 336 days per year exactly
   - No leap years, no exceptions

2. **Month Names**
   - Keep the familiar Gregorian month names:
     - JANUARY, FEBRUARY, MARCH, APRIL, MAY, JUNE,
       JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER

3. **Day Names**
   - Assume standard 7-day week names (MONDAY–SUNDAY) exist in-lore,
     but you do NOT need to implement weekday calculation in code for now.

4. **Epoch and Year Number**
   - The calendar uses a **three-digit civil year count**.
   - The epoch is:
     - **DAY 1 = JANUARY 1, YEAR 412**
   - Day numbering is **1-based**, not elapsed-time-based:
     - DAY 1 → JANUARY 1, 412
     - DAY 2 → JANUARY 2, 412
     - ...
     - DAY 28 → JANUARY 28, 412
     - DAY 29 → FEBRUARY 1, 412
     - ...
     - DAY 336 → DECEMBER 28, 412
     - DAY 337 → JANUARY 1, 413, and so on.

====================
IN-GAME LORE REQUIREMENTS
====================

Create a short in-universe explanation of this calendar suitable for:
- A lore terminal
- A manual entry
- Or flavor text in a station info screen

Requirements for the lore text:

1. Explain that this is an **Interstellar Harmonized Calendar** (or similar name) adopted to standardize timekeeping across worlds, stations, and ships.
2. Mention that planetary calendars still exist locally, but all **navigation, contracts, trade, and starship logs** use this harmonized calendar.
3. Clearly state:
   - 12 equal months
   - 4 weeks of 7 days each
   - 28 days per month
   - 336 days per year
   - No leap years
4. Mention the epoch conceptually: that the current civil era began at Year 0 and that the present game year is **Year 412**.
5. Tone: grounded, slightly bureaucratic, not flowery. Think “in-universe manual” more than “mythic prophecy.”

====================
CODE REQUIREMENTS
====================

I need a Commander X16 BASIC subroutine that converts a **day number** into a **formatted date string** using the harmonized calendar described above.

1. **Environment & Dialect**
   - Target: Commander X16 BASIC
   - Assume C64 BASIC V2–style syntax and limitations:
     - No ELSE, no modern IF…THEN…ELSE bodies
     - No lowercase keywords in final code
   - Code must be valid for a stock X16 BASIC program.

2. **Line Number Range**
   - Place the entire subroutine and its related initialization in the line range:
     - **52000 to 52999**
   - You may use any line increments you like within that range.

3. **Arguments and Return Values**

   Use the following calling convention:

   - `AN(0)` = **DAY NUMBER** (1-based, as described above)
     - DAY 1 = JANUARY 1, 412
   - `AN(1)` = **FORMAT FLAG**:
     - 0 → Full month name: `"NOVEMBER 28TH, 412"`
     - 1 → Short month name: `"NOV 28TH, 412"`
     - 2 → ISO-like numeric: `"412-11-28"`
   - The subroutine must return the formatted date string in:
     - `AS$(0)`

   Elsewhere in the program, I will have already declared:
   - `DIM AN(10),AS$(10)`

4. **Functional Requirements**

   The subroutine must:

   - Accept `AN(0)` as a floating-point day number, but interpret it as a 1-based integer:
     - If `AN(0) < 1`, clamp to day 1.
   - Accept `AN(1)` as the format flag:
     - Clamp <0 to 0 and >2 to 0.
   - Convert the day number into:
     - Year (starting at 412)
     - Month (1–12)
     - Day-of-month (1–28)
   - Use the exact 12×28 day structure:
     - 336 days per year
     - No leap years
   - Convert month index to full and short month names using arrays.
   - Add the correct English ordinal suffix to the day number:
     - `1ST, 2ND, 3RD, 4TH, ...`
     - Handle 11TH, 12TH, 13TH correctly (always `TH`).
   - Construct the output string based on the flag:
     - 0 → `MF$(M%)+" "+DS$+SU$+", "+YS$`
     - 1 → `MS$(M%)+" "+DS$+SU$+", "+YS$`
     - 2 → `YS$+"-"+MM$+"-"+DD$` with month and day zero-padded to 2 digits.

5. **Data Structures**

   - Use string arrays for month names:
     - `MF$(1..12)` = full month names
     - `MS$(1..12)` = short month names
   - You do not need weekday names in this version.
   - Do a one-time initialization of these arrays the first time the subroutine is called, using a flag like `DF%` to avoid re-DIMing.

6. **Style & Constraints**

   - All code must be in **UPPERCASE**.
   - Use only C64/X16 BASIC constructs:
     - `IF ... THEN` with GOTOs or single-line statements, no ELSE.
   - Ensure there is **no RETURN WITHOUT GOSUB** situation:
     - Every `RETURN` must be reachable only via `GOSUB`.
   - Do NOT use any machine code, only BASIC.
   - Keep the code clear and commented, but concise enough to be practical.

====================
OUTPUT FORMAT
====================

Produce your answer in three clearly separated sections:

1. **CALENDAR SUMMARY**
   - A concise description of the harmonized calendar structure and epoch, in plain English, suitable for my design notes.

2. **IN-GAME LORE EXPLANATION**
   - The in-universe explanation text describing the calendar, as specified above.
   - 1–3 short paragraphs max, readable as a terminal entry or manual snippet.

3. **COMMANDER X16 BASIC CODE**
   - The full BASIC listing, all uppercase, with line numbers from 52000–52999.
   - Include:
     - One-time initialization for month name arrays.
     - The main subroutine that:
       - Reads `AN(0)` and `AN(1)`
       - Computes year/month/day
       - Formats the string into `AS$(0)`
   - Make sure the code is ready for me to copy-paste into an X16 BASIC program.
