52000 REM =========================================
52001 REM DATE SUBROUTINE - HARMONIZED 12X28 CAL
52002 REM CALL: AN(0)=DAY NUMBER, AN(1)=FLAG
52003 REM DAY 1 = JANUARY 1, YEAR 412
52004 REM FLAG: 0="NOVEMBER 28TH, 412"
52005 REM        1="NOV 28TH, 412"
52006 REM        2="412-11-28"
52007 REM RET: AS$(0)=DATE STRING IN AS$(0)
52008 REM =========================================
52009 IF DF%=0 THEN GOSUB 52880
52010 D=AN(0)-1
52011 IF D<0 THEN D=0
52012 F=INT(AN(1))
52013 IF F<0 THEN F=0
52014 IF F>2 THEN F=0

52020 YO%=INT(D/336)
52021 Y=412+YO%
52022 D=D-YO%*336

52030 M%=INT(D/28)+1
52031 IF M%<1 THEN M%=1
52032 IF M%>12 THEN M%=12
52033 DAY%=INT(D-(M%-1)*28)+1
52034 IF DAY%<1 THEN DAY%=1
52035 IF DAY%>28 THEN DAY%=28

52040 DS$=MID$(STR$(DAY%),2)

52050 SU$="TH"
52051 T%=DAY%-INT(DAY%/10)*10
52052 U%=DAY%-INT(DAY%/100)*100
52053 IF U%>10 AND U%<14 THEN GOTO 52060
52054 IF T%=1 THEN SU$="ST"
52055 IF T%=2 THEN SU$="ND"
52056 IF T%=3 THEN SU$="RD"

52060 YS$=MID$(STR$(Y),2)

52070 IF F=0 THEN GOSUB 52300:RETURN
52071 IF F=1 THEN GOSUB 52330:RETURN
52072 IF F=2 THEN GOSUB 52360:RETURN

52073 GOSUB 52300
52074 RETURN

52300 REM ----------------------------------
52301 REM FORMAT 0: "NOVEMBER 28TH, 412"
52302 REM ----------------------------------
52303 AS$(0)=MF$(M%)+" "+DS$+SU$+", "+YS$
52304 RETURN

52330 REM ----------------------------------
52331 REM FORMAT 1: "NOV 28TH, 412"
52332 REM ----------------------------------
52333 AS$(0)=MS$(M%)+" "+DS$+SU$+", "+YS$
52334 RETURN

52360 REM ----------------------------------
52361 REM FORMAT 2: "412-11-28"
52362 REM ----------------------------------
52363 MS2$=MID$(STR$(M%),2)
52364 IF M%<10 THEN MS2$="0"+MS2$
52365 DS2$=DS$
52366 IF DAY%<10 THEN DS2$="0"+DS2$
52367 AS$(0)=YS$+"-"+MS2$+"-"+DS2$
52368 RETURN

52880 REM ----------------------------------
52881 REM ONE-TIME INIT: MONTH NAME TABLES
52882 REM ----------------------------------
52883 DIM MF$(12),MS$(12)
52884 DF%=1
52885 MF$(1)="JANUARY":MF$(2)="FEBRUARY":MF$(3)="MARCH"
52886 MF$(4)="APRIL":MF$(5)="MAY":MF$(6)="JUNE"
52887 MF$(7)="JULY":MF$(8)="AUGUST":MF$(9)="SEPTEMBER"
52888 MF$(10)="OCTOBER":MF$(11)="NOVEMBER":MF$(12)="DECEMBER"
52889 MS$(1)="JAN":MS$(2)="FEB":MS$(3)="MAR"
52890 MS$(4)="APR":MS$(5)="MAY":MS$(6)="JUN"
52891 MS$(7)="JUL":MS$(8)="AUG":MS$(9)="SEP"
52892 MS$(10)="OCT":MS$(11)="NOV":MS$(12)="DEC"
52893 RETURN
