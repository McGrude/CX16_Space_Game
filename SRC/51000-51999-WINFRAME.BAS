51000 REM ============================================
51002 REM WINDOW SYSTEM: VARIABLES AND SUBROUTINES
51004 REM ============================================
51006 REM EXTERNAL VARIABLES:
51008 REM   AN(0) = WINDOW LEFT X (COLUMN, 1-BASED)
51010 REM   AN(1) = WINDOW TOP Y  (ROW, 1-BASED)
51012 REM   AN(2) = WINDOW WIDTH  (>=3)
51014 REM   AN(3) = WINDOW HEIGHT (>=4)
51016 REM   AN(4) = TITLE FLAG (0=AUTO, 1=FORCE TITLE BAR)
51018 REM   AN(5) = FILL FLAG (0=NO FILL, 1=FILL INTERIOR)
51020 REM   AN(6) = CORNER FLAG (0=SQUARE, 1=ROUNDED)
51022 REM   AS$(0) = WINDOW TITLE (MUTATED, MAY BE TRUNCATED/PADDED)
51024 REM   ER = ERROR CODE (0 = OK)
51026 REM   ER$ = ERROR STRING
51028 REM INTERNAL AN() SCRATCH:
51030 REM   AN(7) = WINDOW RIGHT X (AN(0)+AN(2)-1)
51032 REM   AN(8) = WINDOW BOTTOM Y (AN(1)+AN(3)-1)
51034 REM   AN(9) = TITLE WIDTH (AN(2)-2)
51036 REM INTERNAL VARIABLES:
51038 REM   WD$() = BORDER GLYPHS AS STRINGS, INDEX 0-8
51040 REM   SP$ = PRE-BUILT SPACE STRING FOR FILLS
51042 REM   X,Y = LOOP INDICES / COORDINATES
51044 REM   H$ = HORIZONTAL LINE BUILD STRING
51046 REM   YT,SS,YS = TITLE ROW, SIDE START, FILL START
51048 REM   T1$,FI$ = TITLE STRING, FILL STRING
51050 REM SUBROUTINES:
51052 REM   51062 WD-INIT         : INIT WD$(), SP$, RESET ER/ER$
51054 REM   51090 WIN-SET-SQUARE  : SET SQUARE CORNERS
51056 REM   51110 WIN-SET-ROUNDED : SET ROUNDED CORNERS
51058 REM   51130 WIN-FRAME-DRAW  : DRAW FRAME, OPTIONAL TITLE AND FILL
51060 REM   51400 WIN-HLINE       : DRAW HORIZONTAL LINE

51062 REM ============================================
51064 REM WD-INIT: BORDER GLYPHS AS PRE-BUILT STRINGS
51066 REM ============================================
51068 DIM WD$(8)
51070 ER=0:ER$=""
51072 WD$(4)=CHR$(125) : REM VERTICAL EDGE
51074 WD$(5)=CHR$(99)  : REM HORIZONTAL EDGE
51076 WD$(6)=CHR$(171) : REM JOIN HORIZ TO LEFT VERT
51078 WD$(7)=CHR$(179) : REM JOIN HORIZ TO RIGHT VERT
51080 WD$(8)=CHR$(166) : REM TITLE FILL GLYPH
51082 REM PRE-BUILD MAX WIDTH SPACE STRING FOR FILLS
51084 SP$="":FOR I=1 TO 78:SP$=SP$+" ":NEXT I
51086 RETURN

51090 REM ============================================
51092 REM WIN-SET-SQUARE: SQUARE CORNERS
51094 REM ============================================
51096 WD$(0)=CHR$(176) : REM SQUARE TL
51098 WD$(1)=CHR$(174) : REM SQUARE TR
51100 WD$(2)=CHR$(173) : REM SQUARE BL
51102 WD$(3)=CHR$(189) : REM SQUARE BR
51104 RETURN

51110 REM ============================================
51112 REM WIN-SET-ROUNDED: ROUNDED CORNERS
51114 REM ============================================
51116 WD$(0)=CHR$(117) : REM ROUNDED TL
51118 WD$(1)=CHR$(105) : REM ROUNDED TR
51120 WD$(2)=CHR$(106) : REM ROUNDED BL
51122 WD$(3)=CHR$(107) : REM ROUNDED BR
51124 RETURN

51130 REM ============================================
51132 REM WIN-FRAME-DRAW: DRAW WINDOW FRAME
51134 REM ============================================
51136 ER=0:ER$=""
51138 REM AN(0)=X  AN(1)=Y  AN(2)=W  AN(3)=H  AN(4)=TITLE FLAG
51140 REM AN(5)=FILL FLAG  AN(6)=CORNER FLAG (0=SQUARE,1=ROUNDED)
51142 IF AN(2)<3 OR AN(3)<4 THEN ER=2:ER$="WINDOW TOO SMALL":RETURN
51144 IF AN(6)<>0 AND AN(6)<>1 THEN ER=3:ER$="BAD CORNER FLAG":RETURN
51146 IF AN(6)=0 THEN GOSUB 51090
51148 IF AN(6)=1 THEN GOSUB 51110
51150 REM DERIVED VALUES
51152 AN(7)=AN(0)+AN(2)-1
51154 AN(8)=AN(1)+AN(3)-1
51156 AN(9)=AN(2)-2
51158 REM BUILD HORIZONTAL EDGE STRING ONCE
51160 H$="":FOR I=1 TO AN(9):H$=H$+WD$(5):NEXT I
51162 REM BUILD FILL STRING ONCE IF NEEDED
51164 IF AN(5)=1 THEN FI$=LEFT$(SP$,AN(9))
51166 REM TOP BORDER
51168 LOCATE AN(1),AN(0):PRINT WD$(0);H$;WD$(1);
51170 REM TITLE HANDLING
51172 IF AS$(0)="" AND AN(4)=0 THEN GOTO 51230
51174 REM BUILD TITLE LINE INTO T1$
51176 IF AS$(0)<>"" THEN GOTO 51190
51178 REM EMPTY TITLE BUT FORCED BAR: PURE FILL GLYPHS
51180 T1$=""
51182 FOR I=1 TO AN(9):T1$=T1$+WD$(8):NEXT I
51184 GOTO 51206
51190 REM NON-EMPTY TITLE: TRUNCATE AND PAD
51192 IF LEN(AS$(0))>AN(9) THEN AS$(0)=LEFT$(AS$(0),AN(9))
51194 T1$=AS$(0)+" "
51196 PA=AN(9)-LEN(T1$)
51198 IF PA>0 THEN FOR I=1 TO PA:T1$=T1$+WD$(8):NEXT I
51200 REM DRAW TITLE ROW (SINGLE PRINT)
51206 YT=AN(1)+1
51208 LOCATE YT,AN(0):PRINT WD$(4);T1$;WD$(4);
51210 REM TITLE SEPARATOR ROW (SINGLE PRINT)
51212 Y=AN(1)+2
51214 LOCATE Y,AN(0):PRINT WD$(6);H$;WD$(7);
51216 REM SIDE AND FILL START ROW WITH TITLE BAR
51218 SS=AN(1)+3
51220 YS=SS
51222 GOTO 51240
51230 REM NO TITLE BAR: SIDE AND FILL START JUST BELOW TOP
51232 SS=AN(1)+1
51234 YS=SS
51240 REM SIDE BORDERS AND OPTIONAL FILL COMBINED
51242 IF AN(5)=0 THEN GOTO 51260
51244 REM SIDES WITH FILL (SINGLE PRINT PER ROW)
51246 FOR Y=SS TO AN(8)-1
51248 LOCATE Y,AN(0):PRINT WD$(4);FI$;WD$(4);
51250 NEXT Y
51252 GOTO 51280
51260 REM SIDES ONLY (TWO LOCATES PER ROW)
51262 FOR Y=SS TO AN(8)-1
51264 LOCATE Y,AN(0):PRINT WD$(4);
51266 LOCATE Y,AN(7):PRINT WD$(4);
51268 NEXT Y
51280 REM BOTTOM BORDER (SINGLE PRINT)
51282 LOCATE AN(8),AN(0):PRINT WD$(2);H$;WD$(3);
51284 RETURN

51400 REM ============================================
51402 REM WIN-HLINE: GENERAL HORIZONTAL LINE
51404 REM   INPUT: Y=ROW, L$=LEFT, R$=RIGHT, M$=MIDDLE CHAR
51406 REM   USES H$ IF M$=WD$(5), ELSE BUILDS NEW
51408 REM ============================================
51410 IF M$=WD$(5) THEN LOCATE Y,AN(0):PRINT L$;H$;R$;:RETURN
51412 HT$="":FOR I=1 TO AN(9):HT$=HT$+M$:NEXT I
51414 LOCATE Y,AN(0):PRINT L$;HT$;R$;
51416 RETURN
